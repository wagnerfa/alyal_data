{% extends "base.html" %}

{% block title %}Empresas - Alyal{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Empresas monitoradas</h1>
        <div class="user-info">
            <div class="user-details">
                <h3>{{ current_user.username }}</h3>
                <span class="badge badge-manager">Gestor</span>
            </div>
            <div class="user-avatar">
                {{ current_user.username[0].upper() }}
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>Cadastrar nova empresa</h3>
            <p class="card-description">Preencha os dados de acesso da nova empresa e, se desejar, envie o logotipo para personalizar o painel.</p>
            <form method="post" enctype="multipart/form-data">
                <input type="hidden" name="action" value="create">
                <div class="form-group">
                    <label for="companyUsername">Usuário</label>
                    <input type="text" id="companyUsername" name="username" placeholder="empresa_exemplo" required>
                </div>
                <div class="form-group">
                    <label for="companyEmail">E-mail</label>
                    <input type="email" id="companyEmail" name="email" placeholder="contato@empresa.com" required>
                </div>
                <div class="form-group">
                    <label for="companyPassword">Senha inicial</label>
                    <input type="password" id="companyPassword" name="password" placeholder="Mínimo 6 caracteres" required>
                </div>
                <div class="form-group">
                    <label for="companyPasswordConfirm">Confirmar senha</label>
                    <input type="password" id="companyPasswordConfirm" name="confirm_password" required>
                </div>
                <div class="form-group">
                    <label for="companyLogo">Logotipo (opcional)</label>
                    <input type="file" id="companyLogo" name="logo" accept=".png,.jpg,.jpeg,.gif,.webp">
                    <span class="form-hint">Formatos aceitos: {{ allowed_extensions }} (até 5MB).</span>
                </div>
                <button type="submit" class="btn btn-primary">Adicionar empresa</button>
            </form>
        </div>
    </div>

    <div class="dashboard-grid company-grid">
        {% for company in companies %}
            <div class="dashboard-card company-card">
                <div class="company-card-header">
                    <div class="company-card-info">
                        {% if company.logo_filename %}
                            <img src="{{ url_for('static', filename='uploads/logos/' ~ company.logo_filename) }}" alt="Logotipo de {{ company.username }}" class="company-logo">
                        {% else %}
                            <div class="company-logo-placeholder">{{ company.username[0].upper() }}</div>
                        {% endif %}
                        <div>
                            <h3>{{ company.username }}</h3>
                            <p class="card-description">{{ company.email }}</p>
                        </div>
                    </div>
                </div>
                <div class="company-actions">
                    <form method="post" enctype="multipart/form-data" class="company-form">
                        <input type="hidden" name="action" value="logo">
                        <input type="hidden" name="user_id" value="{{ company.id }}">
                        <div class="form-group">
                            <label for="logo-{{ company.id }}">Atualizar logotipo</label>
                            <input type="file" id="logo-{{ company.id }}" name="logo" accept=".png,.jpg,.jpeg,.gif,.webp">
                            <span class="form-hint">Formatos aceitos: {{ allowed_extensions }}.</span>
                        </div>
                        <button type="submit" class="btn btn-secondary">Enviar novo logotipo</button>
                    </form>
                    <form method="post" class="company-form">
                        <input type="hidden" name="action" value="password">
                        <input type="hidden" name="user_id" value="{{ company.id }}">
                        <div class="form-group">
                            <label for="new-password-{{ company.id }}">Nova senha</label>
                            <input type="password" id="new-password-{{ company.id }}" name="new_password" placeholder="Mínimo 6 caracteres" required>
                        </div>
                        <div class="form-group">
                            <label for="confirm-password-{{ company.id }}">Confirmar nova senha</label>
                            <input type="password" id="confirm-password-{{ company.id }}" name="confirm_password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Atualizar senha</button>
                    </form>
                    <form method="post" class="company-form" onsubmit="return confirm('Deseja realmente excluir esta empresa? Esta ação não pode ser desfeita.');">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="user_id" value="{{ company.id }}">
                        <button type="submit" class="btn btn-danger">Remover empresa</button>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="dashboard-card">
                <h3>Nenhuma empresa cadastrada</h3>
                <p class="card-description">Adicione as empresas clientes para liberar o acesso ao painel personalizado.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
