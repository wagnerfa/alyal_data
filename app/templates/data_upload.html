{% extends "base.html" %}

{% block title %}Importar Vendas - Alyal{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>üì• Importa√ß√£o de Vendas</h1>
    </div>

    <!-- SE√á√ÉO 1: Download do Template -->
    <div class="dashboard-card template-card">
        <h3>üìã 1. Baixe o Template Padronizado</h3>
        <p class="card-description">
            <strong>IMPORTANTE:</strong> Este sistema usa um template CSV padronizado para garantir 100% de compatibilidade.
            Voc√™ deve adaptar seus dados do marketplace para este formato antes de importar.
        </p>

        <a href="{{ url_for('data.download_template') }}" class="btn btn-primary" download>
            ‚¨áÔ∏è Baixar Template CSV
        </a>

        <div class="template-info">
            <h4>O que est√° no template?</h4>
            <ul class="info-list">
                <li><strong>19 colunas pr√©-definidas</strong> em ordem fixa</li>
                <li><strong>Linha de exemplo</strong> mostrando como preencher</li>
                <li><strong>Campos obrigat√≥rios:</strong> data_venda, sku, nome_produto, status_pedido, valor_total_venda</li>
                <li><strong>Campos opcionais:</strong> dados do cliente, financeiros, geogr√°ficos</li>
            </ul>
        </div>
    </div>

    <!-- SE√á√ÉO 2: Como Adaptar -->
    <div class="dashboard-card guide-card">
        <h3>üîß 2. Adapte seus Dados do Marketplace</h3>

        <div class="guide-steps">
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Abra o template no Excel/Google Sheets</h4>
                    <p>O arquivo baixado pode ser editado em qualquer planilha</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Copie seus dados do marketplace</h4>
                    <p>Exporte o relat√≥rio do Mercado Livre, Shopee ou Magalu</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Cole na ordem das colunas do template</h4>
                    <p><strong>ATEN√á√ÉO:</strong> A ordem das colunas √© fixa. N√£o mude!</p>
                    <ul>
                        <li>Coluna A (data_venda): formato YYYY-MM-DD (ex: 2025-01-15)</li>
                        <li>Coluna B (sku): c√≥digo do produto</li>
                        <li>Coluna C (nome_produto): descri√ß√£o</li>
                        <li>Coluna D (status_pedido): pago, enviado, entregue ou cancelado</li>
                        <li>Coluna E (valor_total_venda): valor decimal com ponto (ex: 150.50)</li>
                        <li>Demais colunas: preencha se tiver os dados</li>
                    </ul>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Salve como CSV (UTF-8)</h4>
                    <p>Excel: "Salvar Como" ‚Üí CSV UTF-8<br>
                    Google Sheets: "Baixar" ‚Üí CSV</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SE√á√ÉO 3: Upload -->
    <div class="dashboard-card upload-card">
        <h3>üì§ 3. Fa√ßa o Upload do Arquivo Adaptado</h3>

        <form method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="company_id">üè¢ Empresa</label>
                <select id="company_id" name="company_id" required>
                    <option value="">Selecione a empresa</option>
                    {% for company in companies %}
                        <option value="{{ company.id }}" {% if selected_company == company.id %}selected{% endif %}>
                            {{ company.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="marketplace_id">üõí Marketplace</label>
                <select id="marketplace_id" name="marketplace_id" required>
                    <option value="">Selecione o marketplace</option>
                    {% for marketplace in marketplaces %}
                        <option value="{{ marketplace.id }}">{{ marketplace.nome }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="file">üìÅ Arquivo CSV (adaptado do template)</label>
                <input type="file" id="file" name="file" accept=".csv" required>
                <small class="form-help">Apenas arquivos CSV no formato do template</small>
            </div>

            <button type="submit" class="btn btn-primary">üöÄ Importar Dados</button>
        </form>
    </div>

    <!-- Dicas Importantes -->
    <div class="dashboard-card tips-card">
        <h3>üí° Dicas Importantes</h3>
        <ul class="tips-list">
            <li><strong>N√£o altere a ordem das colunas</strong> - o sistema l√™ pela posi√ß√£o</li>
            <li><strong>N√£o remova o cabe√ßalho</strong> - ele √© ignorado mas ajuda na edi√ß√£o</li>
            <li><strong>Use formato de data YYYY-MM-DD</strong> (ano-m√™s-dia com h√≠fens)</li>
            <li><strong>Valores decimais com ponto</strong>, n√£o v√≠rgula (150.50, n√£o 150,50)</li>
            <li><strong>Campos vazios s√£o OK</strong> - deixe em branco se n√£o tiver o dado</li>
            <li><strong>Salve em UTF-8</strong> para evitar problemas com acentos</li>
        </ul>
    </div>
</div>

<style>
.template-card {
    background: linear-gradient(135deg, rgba(52, 191, 163, 0.1), rgba(91, 155, 213, 0.1));
    border-left: 4px solid #34BFA3;
}

.template-info {
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--surface-color, #f8f9fa);
    border-radius: 8px;
}

.template-info h4 {
    margin: 0 0 0.75rem 0;
    color: var(--text-primary);
}

.info-list {
    margin: 0;
    padding-left: 1.5rem;
}

.info-list li {
    margin: 0.5rem 0;
    color: var(--text-secondary);
}

.guide-steps {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-top: 1rem;
}

.step {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8082A6, #5B9BD5);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
    flex-shrink: 0;
}

.step-content h4 {
    margin: 0 0 0.5rem 0;
    color: var(--text-primary);
}

.step-content p,
.step-content ul {
    margin: 0.5rem 0;
    color: var(--text-secondary);
}

.step-content ul {
    padding-left: 1.5rem;
}

.tips-list {
    margin: 0;
    padding-left: 1.5rem;
}

.tips-list li {
    margin: 0.75rem 0;
    color: var(--text-secondary);
}

.tips-list strong {
    color: var(--text-primary);
}

@media (max-width: 768px) {
    .step {
        flex-direction: column;
    }

    .step-number {
        align-self: flex-start;
    }
}
</style>
{% endblock %}
