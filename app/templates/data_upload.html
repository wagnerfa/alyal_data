{% extends "base.html" %}

{% block title %}Importar Vendas - Alyal{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Importação de Vendas</h1>
    </div>

    <div class="dashboard-card">
        <h3>Formato esperado</h3>
        <p class="card-description">Utilize arquivos CSV com cabeçalho contendo as colunas abaixo (sinônimos comuns também são aceitos, como "produto" para <code>nome_produto</code> ou "valor" para <code>valor_total_venda</code>).</p>
        <ul class="import-notes">
            <li><code>nome_produto</code></li>
            <li><code>sku</code></li>
            <li><code>status_pedido</code> (normalizado para minúsculas e sem acentos)</li>
            <li><code>data_venda</code> (formatos aceitos: YYYY-MM-DD, DD/MM/YYYY ou DD-MM-YYYY)</li>
            <li><code>valor_total_venda</code> (aceita 1.234,56 ou 1234.56)</li>
        </ul>
        <p class="card-description">O marketplace é selecionado no envio. Delimitadores <code>;</code> e <code>,</code> são detectados automaticamente. Tamanho máximo permitido: 2MB.</p>
    </div>

    <div class="dashboard-card">
        <form method="post" enctype="multipart/form-data" class="upload-form">
            <div class="form-group">
                <label for="company_id">Empresa</label>
                <select id="company_id" name="company_id" required>
                    <option value="">Selecione</option>
                    {% for company in companies %}
                        <option value="{{ company.id }}" {% if selected_company == company.id %}selected{% endif %}>{{ company.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="marketplace_id">Marketplace</label>
                <select id="marketplace_id" name="marketplace_id" required>
                    <option value="">Selecione</option>
                    {% for marketplace in marketplaces %}
                        <option value="{{ marketplace.id }}" {% if selected_marketplace == marketplace.id %}selected{% endif %}>{{ marketplace.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="company_id">Empresa</label>
                <select id="company_id" name="company_id">
                    <option value="">Sem vínculo</option>
                    {% for company in companies %}
                        <option value="{{ company.id }}" {% if selected_company == company.id %}selected{% endif %}>{{ company.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="file">Arquivo CSV</label>
                <input type="file" id="file" name="file" accept=".csv" required>
            </div>
            <button type="submit" class="btn btn-primary">Importar vendas</button>
        </form>
        <p class="card-description" style="margin-top: 20px;">Precisa conferir os registros importados? <a href="{{ url_for('data.sales_list', company_id=selected_company if selected_company else None) }}">Acesse a lista de vendas</a>.</p>
    </div>
</div>
{% endblock %}
